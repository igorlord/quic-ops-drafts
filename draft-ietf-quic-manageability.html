<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Manageability of the QUIC Transport Protocol</title>

  
<style type="text/css">/*<![CDATA[*/

body {
  font: 16px "Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 24px;
  margin: 75px auto;
  max-width: 624px;
  padding: 0 5px;
}

.title, .filename, h1, h2, h3, h4, h5 {
  font: 16px "Roboto Condensed","Helvetica Neue","Open Sans",Helvetica,Calibri,sans-serif;
  font-size-adjust: 0.5;
  font-weight: bold;
  color: #333;
  line-height: 100%;
  margin: 1.2em 0 0.3em;
}
.title, #rfc\.title h1 { font-size: 32px; }
h1, section h1, h2, section h2, section h3, nav h2 { font-size: 20px; }
h3, section h4, h4, section h5 { font-size: 16px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header, table#rfc\.headerblock {
  width: 100%;
}
table.header td, table#rfc\.headerblock td {
  border: none;
  background-color: transparent;
  color: black;
  padding: 0;
}
.filename {
  display: block;
  color: rgb(119, 119, 119);
  font-size: 20px;
  font-weight: normal;
  line-height: 100%;
  margin: 10px 0 32px;
}
#rfc\.abstract+p, #rfc\.abstract p {
  font-size: 20px;
  line-height: 28px;
}

samp, tt, code, pre, span.tt {
  font: 13.5px Consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure, caption {
  font-style: italic;
  margin: 0 1.5em;
  text-align: left;
}

address {
  margin: 16px 2px;
  line-height: 20px;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn, address b {
  font-weight: normal;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}
hr.noprint {
  display: none;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

p, ol, ul, li {
  padding: 0;
}
p {
  margin: 0.5em 0;
}
ol, ul {
  margin: 0.2em 0 0.2em 2em;
}
li {
  margin: 0.2em 0;
}
address {
  font-style: normal;
}

ul.toc ul {
  margin: 0 0 0 2em;
}
ul.toc li {
  list-style: none;
  margin: 0;
}

@media screen and (min-width: 924px) {
  body {
    padding-right: 350px;
  }
  body>ul.toc, body>#rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    z-index: 1;
    overflow: auto;
    overscroll-behavior: contain;
  }
  body>#rfc\.toc {
    top: 55px;
  }
  body>ul.toc {
    top: 100px;
  }

  ul.toc {
    margin: 0 0 0 4px;
    font-size: 12px;
    line-height: 20px;
  }
  ul.toc ul {
    margin-left: 1.2em;
  }
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
/*]]>*/</style>
<meta name="viewport" content="initial-scale=1.0">


  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Notational Conventions">
<link href="#rfc.section.2" rel="Chapter" title="2 Features of the QUIC Wire Image">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 QUIC Packet Header Structure">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Coalesced Packets">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Use of Port Numbers">
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 The QUIC handshake">
<link href="#rfc.section.2.5" rel="Chapter" title="2.5 Integrity Protection of the Wire Image">
<link href="#rfc.section.2.6" rel="Chapter" title="2.6 Connection ID and Rebinding">
<link href="#rfc.section.2.7" rel="Chapter" title="2.7 Packet Numbers">
<link href="#rfc.section.2.8" rel="Chapter" title="2.8 Version Negotiation and Greasing">
<link href="#rfc.section.3" rel="Chapter" title="3 Network-visible information about QUIC flows">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Identifying QUIC traffic">
<link href="#rfc.section.3.1.1" rel="Chapter" title="3.1.1 Identifying Negotiated Version">
<link href="#rfc.section.3.1.2" rel="Chapter" title="3.1.2 Rejection of Garbage Traffic">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Connection confirmation">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Application Identification">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Flow association">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 Flow teardown">
<link href="#rfc.section.3.6" rel="Chapter" title="3.6 Flow symmetry measurement">
<link href="#rfc.section.3.7" rel="Chapter" title="3.7 Round-Trip Time (RTT) Measurement">
<link href="#rfc.section.3.7.1" rel="Chapter" title="3.7.1 Measuring initial RTT">
<link href="#rfc.section.3.7.2" rel="Chapter" title="3.7.2 Using the Spin Bit for Passive RTT Measurement">
<link href="#rfc.section.4" rel="Chapter" title="4 Specific Network Management Tasks">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Stateful treatment of QUIC traffic">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Passive network performance measurement and troubleshooting">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Server cooperation with load balancers">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 DDoS Detection and Mitigation">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Distinguishing acknowledgment traffic">
<link href="#rfc.section.4.6" rel="Chapter" title="4.6 QoS support and ECMP">
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Contributors">
<link href="#rfc.section.8" rel="Chapter" title="8 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.22.1 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Kuehlewind, M. and B. Trammell" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-quic-manageability-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2019-07-04" />
  <meta name="dct.abstract" content="This document discusses manageability of the QUIC transport protocol, focusing on caveats impacting network operations involving QUIC traffic. Its intended audience is network operators, as well as content providers that rely on the use of QUIC-aware middleboxes, e.g. for load balancing." />
  <meta name="description" content="This document discusses manageability of the QUIC transport protocol, focusing on caveats impacting network operations involving QUIC traffic. Its intended audience is network operators, as well as content providers that rely on the use of QUIC-aware middleboxes, e.g. for load balancing." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">M. Kuehlewind</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Ericsson</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">B. Trammell</td>
</tr>
<tr>
<td class="left">Expires: January 5, 2020</td>
<td class="right">Google</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">July 04, 2019</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Manageability of the QUIC Transport Protocol<br />
  <span class="filename">draft-ietf-quic-manageability-latest</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document discusses manageability of the QUIC transport protocol, focusing on caveats impacting network operations involving QUIC traffic. Its intended audience is network operators, as well as content providers that rely on the use of QUIC-aware middleboxes, e.g. for load balancing.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 5, 2020.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2019 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Notational Conventions</a>
</li>
</ul><li>2.   <a href="#rfc.section.2">Features of the QUIC Wire Image</a>
</li>
<ul><li>2.1.   <a href="#rfc.section.2.1">QUIC Packet Header Structure</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Coalesced Packets</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">Use of Port Numbers</a>
</li>
<li>2.4.   <a href="#rfc.section.2.4">The QUIC handshake</a>
</li>
<li>2.5.   <a href="#rfc.section.2.5">Integrity Protection of the Wire Image</a>
</li>
<li>2.6.   <a href="#rfc.section.2.6">Connection ID and Rebinding</a>
</li>
<li>2.7.   <a href="#rfc.section.2.7">Packet Numbers</a>
</li>
<li>2.8.   <a href="#rfc.section.2.8">Version Negotiation and Greasing</a>
</li>
</ul><li>3.   <a href="#rfc.section.3">Network-visible information about QUIC flows</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Identifying QUIC traffic</a>
</li>
<ul><li>3.1.1.   <a href="#rfc.section.3.1.1">Identifying Negotiated Version</a>
</li>
<li>3.1.2.   <a href="#rfc.section.3.1.2">Rejection of Garbage Traffic</a>
</li>
</ul><li>3.2.   <a href="#rfc.section.3.2">Connection confirmation</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Application Identification</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Flow association</a>
</li>
<li>3.5.   <a href="#rfc.section.3.5">Flow teardown</a>
</li>
<li>3.6.   <a href="#rfc.section.3.6">Flow symmetry measurement</a>
</li>
<li>3.7.   <a href="#rfc.section.3.7">Round-Trip Time (RTT) Measurement</a>
</li>
<ul><li>3.7.1.   <a href="#rfc.section.3.7.1">Measuring initial RTT</a>
</li>
<li>3.7.2.   <a href="#rfc.section.3.7.2">Using the Spin Bit for Passive RTT Measurement</a>
</li>
</ul></ul><li>4.   <a href="#rfc.section.4">Specific Network Management Tasks</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Stateful treatment of QUIC traffic</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Passive network performance measurement and troubleshooting</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Server cooperation with load balancers</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">DDoS Detection and Mitigation</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">Distinguishing acknowledgment traffic</a>
</li>
<li>4.6.   <a href="#rfc.section.4.6">QoS support and ECMP</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">IANA Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Contributors</a>
</li>
<li>8.   <a href="#rfc.section.8">Acknowledgments</a>
</li>
<li>9.   <a href="#rfc.references">References</a>
</li>
<ul><li>9.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">QUIC <a href="#QUIC-TRANSPORT" class="xref">[QUIC-TRANSPORT]</a> is a new transport protocol currently under development in the IETF QUIC working group, focusing on support of semantics as needed for HTTP/2 <a href="#QUIC-HTTP" class="xref">[QUIC-HTTP]</a>.  Based on current deployment practices, QUIC is encapsulated in UDP and encrypted by default. The current version of QUIC integrates TLS <a href="#QUIC-TLS" class="xref">[QUIC-TLS]</a> to encrypt all payload data and most control information.</p>
<p id="rfc.section.1.p.2">Given that QUIC is an end-to-end transport protocol, all information in the protocol header, even that which can be inspected, is not meant to be mutable by the network, and is therefore integrity-protected. While less information is visible to the network than for TCP, integrity protection can also simplify troubleshooting because none of the nodes on the network path can modify the transport layer information.</p>
<p id="rfc.section.1.p.3">This document provides guidance for network operation on the management of QUIC traffic. This includes guidance on how to interpret and utilize information that is exposed by QUIC to the network as well as explaining requirement and assumptions that the QUIC protocol design takes toward the expected network treatment. It also discusses how common network management practices will be impacted by QUIC.</p>
<p id="rfc.section.1.p.4">Since QUIC&#8217;s wire image <a href="#WIRE-IMAGE" class="xref">[WIRE-IMAGE]</a> is integrity protected and not modifiable on path, in-network operations are not possible without terminating the QUIC connection, for instance using a back-to-back proxy. Proxy operations are not in scope for this document. QUIC proxies must be fully-fledged QUIC endpoints, implementing the transport as defined in <a href="#QUIC-TRANSPORT" class="xref">[QUIC-TRANSPORT]</a> and <a href="#QUIC-TLS" class="xref">[QUIC-TLS]</a> as well as proxy-relevant semantics for the application(s) running over QUIC (e.g. HTTP/3 as defined in <a href="#QUIC-HTTP" class="xref">[QUIC-HTTP]</a>).</p>
<p id="rfc.section.1.p.5">Network management is not a one-size-fits-all endeavour: practices considered necessary or even mandatory within enterprise networks with certain compliance requirements, for example, would be impermissible on other networks without those requirements. This document therefore does not make any specific recommendations as to which practices should or should not be applied; for each practice, it describes what is and is not possible with the QUIC transport protocol as defined.</p>
<p id="rfc.section.1.p.6">QUIC is at the moment very much a moving target. This document refers the state of the QUIC working group drafts as well as to changes under discussion, via issues and pull requests in GitHub current as of the time of writing.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#notational-conventions" id="notational-conventions">Notational Conventions</a>
</h1>
<p id="rfc.section.1.1.p.1">The key words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;REQUIRED&#8221;, &#8220;SHALL&#8221;, &#8220;SHALL NOT&#8221;, &#8220;SHOULD&#8221;, &#8220;SHOULD NOT&#8221;, &#8220;RECOMMENDED&#8221;, &#8220;NOT RECOMMENDED&#8221;, &#8220;MAY&#8221;, and &#8220;OPTIONAL&#8221; in this document are to be interpreted as described in BCP 14 <a href="#RFC2119" class="xref">[RFC2119]</a> <a href="#RFC8174" class="xref">[RFC8174]</a> when, and only when, they appear in all capitals, as shown here.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#sec-wire-image" id="sec-wire-image">Features of the QUIC Wire Image</a>
</h1>
<p id="rfc.section.2.p.1">In this section, we discusses those aspects of the QUIC transport protocol that have an impact on the design and operation of devices that forward QUIC packets.  Here, we are concerned primarily with the unencrypted part of QUIC&#8217;s wire image <a href="#WIRE-IMAGE" class="xref">[WIRE-IMAGE]</a>, which we define as the information available in the packet header in each QUIC packet, and the dynamics of that information. Since QUIC is a versioned protocol, the wire image of the header format can also change from version to version. However, at least the mechanism by which a receiver can determine which version is used and the meaning and location of fields used in the version negotiation process is invariant <a href="#QUIC-INVARIANTS" class="xref">[QUIC-INVARIANTS]</a>.</p>
<p id="rfc.section.2.p.2">This document is focused on the protocol as presently defined in <a href="#QUIC-TRANSPORT" class="xref">[QUIC-TRANSPORT]</a> and <a href="#QUIC-TLS" class="xref">[QUIC-TLS]</a>, and will change to track those documents.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#public-header" id="public-header">QUIC Packet Header Structure</a>
</h1>
<p id="rfc.section.2.1.p.1">QUIC packets may have either a long header, or a short header. The first bit of the QUIC header indicates which type of header is present.</p>
<p id="rfc.section.2.1.p.2">The long header exposes more information. It is used during connection establishment, including version negotiation, retry, and 0-RTT data. It contains a version number, as well as source and destination connection IDs for grouping packets belonging to the same flow. The definition and location of these fields in the QUIC long header are invariant for future versions of QUIC, although future versions of QUIC may provide additional fields in the long header <a href="#QUIC-INVARIANTS" class="xref">[QUIC-INVARIANTS]</a>.</p>
<p id="rfc.section.2.1.p.3">Short headers are used after connection establishment, and contain only an optional destination connection ID and the spin bit for RTT measurement.</p>
<p id="rfc.section.2.1.p.4">The following information is exposed in QUIC packet headers:</p>
<p></p>

<ul>
<li>demux bit: the second most significant bit of the first octet every QUIC packet of the current version is set to 1, for demultiplexing with other UDP-encapsulated protocols.</li>
<li>latency spin bit: the third most significant bit of first octet in the short packet header. The spin bit is set by endpoints such that  tracking edge transitions can be used to passively observe end-to-end RTT. See <a href="#spin-usage" class="xref">Section 3.7.2</a> for further details.</li>
<li>header type: the long header has a 2 bit packet type field following the Header Form bit. Header types correspond to stages of the handshake; see Section 17.2 of <a href="#QUIC-TRANSPORT" class="xref">[QUIC-TRANSPORT]</a>.</li>
<li>version number: the version number present in the long header, and identifies the version used for that packet. Note that during Version Negotiation (see <a href="#version" class="xref">Section 2.8</a>, and Section 17.2.1 of <a href="#QUIC-TRANSPORT" class="xref">[QUIC-TRANSPORT]</a>, the version number field has a special value (0x00000000) that identifies the packet as a Version Negotiation packet.</li>
<li>source and destination connection ID: short and long packet headers carry a destination connection ID, a variable-length field that can be used to identify the connection associated with a QUIC packet, for load-balancing and NAT rebinding purposes; see <a href="#sec-loadbalancing" class="xref">Section 4.3</a> and <a href="#rebinding" class="xref">Section 2.6</a>. Long packet headers additionally carry a source connection ID. The source connection ID corresponds to the destination connection ID the source would like to have on packets sent to it, and is only present on long packet headers. On long header packets, the length of the connection IDs is also present; on short header packets, the length of the destination connection ID is implicit.</li>
<li>length: the length of the remaining QUIC packet after the length field, present on long headers. This field is used to implement coalesced packets during the handshake (see <a href="#coalesced" class="xref">Section 2.2</a>).</li>
<li>token: Initial packets may contain a token, a variable-length opaque value optionally sent from client to server, used for validating the client&#8217;s address. Retry packets also contain a token, which can be used by the client in an Initial packet on a subsequent connection attempt. The length of the token is explicit in both cases.</li>
</ul>
<p id="rfc.section.2.1.p.6">Retry and Version Negotiation packets are not encrypted or obfuscated in any way. For other kinds of packets, other information in the packet headers is cryptographically obfuscated:</p>
<p></p>

<ul>
<li>packet number: Most packets (with the exception of Version Negotiation and Retry packets) have an associated packet number; however, this packet number is encrypted, and therefore not of use to on-path observers. The offset of the packet number is encoded in the header for packets with long headers, while it is implicit (depending on Destination Connection ID length) in short header packets. The length of the packet number is cryptographically obfuscated.</li>
<li>key phase: The Key Phase bit, present in short headers, specifies the keys used to encrypt the packet, supporting key rotation. The Key Phase bit is cryptographically obfuscated.</li>
</ul>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#coalesced" id="coalesced">Coalesced Packets</a>
</h1>
<p id="rfc.section.2.2.p.1">Multiple QUIC packets may be coalesced into a UDP datagram, with a datagram carrying one or more long header packets followed by zero or one short header packets. When packets are coalesced, the Length fields in the long headers are used to separate QUIC packets. The length header field is variable length and its position in the header is also variable depending on the length of the source and destination connection ID. See Section 4.6 of <a href="#QUIC-TRANSPORT" class="xref">[QUIC-TRANSPORT]</a>.</p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> <a href="#use-of-port-numbers" id="use-of-port-numbers">Use of Port Numbers</a>
</h1>
<p id="rfc.section.2.3.p.1">Applications that have a mapping for TCP as well as QUIC are expected to use the same port number for both services. However, as with TCP-based services, especially when application layer information is encrypted, there is no guarantee that a specific application will use the registered port, or the used port is carrying traffic belonging to the respective registered service. For example, <a href="#QUIC-TRANSPORT" class="xref">[QUIC-TRANSPORT]</a> specifies the use of Alt-Svc for discovery of QUIC/HTTP services on other ports.</p>
<p id="rfc.section.2.3.p.2">Further, as QUIC has a connection ID, it is also possible to maintain multiple QUIC connections over one 5-tuple. However, if the connection ID is not present in the packet header, all packets of the 5-tuple belong to the same QUIC connection.</p>
<h1 id="rfc.section.2.4">
<a href="#rfc.section.2.4">2.4.</a> <a href="#handshake" id="handshake">The QUIC handshake</a>
</h1>
<p id="rfc.section.2.4.p.1">New QUIC connections are established using a handshake, which is distinguishable on the wire and contains some information that can be passively observed.</p>
<p id="rfc.section.2.4.p.2">To illustrate the information visible in the QUIC wire image during the handshake, we first show the general communication pattern visible in the UDP datagrams containing the QUIC handshake, then examine each of the datagrams in detail.</p>
<p id="rfc.section.2.4.p.3">In the nominal case, the QUIC handshake can be recognized on the wire through at least four datagrams we&#8217;ll call &#8220;QUIC Client Hello&#8221;, &#8220;QUIC Server Hello&#8221;, and &#8220;Initial Completion&#8221;, and &#8220;Handshake Completion&#8221;, for purposes of this illustration, as shown in <a href="#fig-handshake" class="xref">Figure 1</a>.</p>
<p id="rfc.section.2.4.p.4">Packets in the handshake belong to three separate cryptographic and transport contexts (&#8220;Initial&#8221;, which contains observable payload, and &#8220;Handshake&#8221; and &#8220;1-RTT&#8221;, which do not). QUIC packets in separate contexts during the handshake are generally coalesced (see <a href="#coalesced" class="xref">Section 2.2</a>) in order to reduce the number of UDP datagrams sent during the handshake.</p>
<p id="rfc.section.2.4.p.5">As shown here, the client can send 0-RTT data as soon as it has sent its Client Hello, and the server can send 1-RTT data as soon as it has sent its Server Hello.</p>
<div id="rfc.figure.1"></div>
<div id="fig-handshake"></div>
<pre>
Client                                    Server
  |                                          |
  +----QUIC Client Hello--------------------&gt;|
  +----(zero or more 0RTT)------------------&gt;|
  |                                          |
  |&lt;--------------------QUIC Server Hello----+
  |&lt;---------(1RTT encrypted data starts)----+
  |                                          |
  +----Initial Completion-------------------&gt;|
  +----(1RTT encrypted data starts)---------&gt;|
  |                                          |
  |&lt;-----------------Handshake Completion----+
  |                                          |
</pre>
<p class="figure">Figure 1: General communication pattern visible in the QUIC handshake</p>
<p id="rfc.section.2.4.p.6">A typical handshake starts with the client sending of a QUIC Client Hello datagram as shown in <a href="#fig-client-hello" class="xref">Figure 2</a>, which elicits a QUIC Server Hello datagram as shown in <a href="#fig-server-hello" class="xref">Figure 3</a> typically containing three packets: an Initial packet with the Server Hello, a Handshake packet with the rest of the server&#8217;s side of the TLS handshake, and initial 1-RTT data, if present.</p>
<p id="rfc.section.2.4.p.7">The content of QUIC Initial packets are encrypted using Initial Secrets, which are derived from a per-version constant and the client&#8217;s destination connection ID; they are therefore observable by any on-path device that knows the per-version constant; we therefore consider these as visible in our illustration. The content of QUIC Handshake packets are encrypted using keys established during the initial handshake exchange, and are therefore not visible.</p>
<p id="rfc.section.2.4.p.8">Initial, Handshake, and the Short Header packets transmitted after the handshake belong to cryptographic and transport contexts. The Initial Completion <a href="#fig-init-complete" class="xref">Figure 4</a> and the Handshake Completion <a href="#fig-hs-complete" class="xref">Figure 5</a> datagrams finish these first two contexts, by sending the final acknowledgment and finishing the transmission of CRYPTO frames.</p>
<div id="rfc.figure.2"></div>
<div id="fig-client-hello"></div>
<pre>
+----------------------------------------------------------+
| UDP header (source and destination UDP ports)            |
+----------------------------------------------------------+
| QUIC long header (type = Initial, Version, DCID, SCID) (Length)
+----------------------------------------------------------+  |
| QUIC CRYPTO frame header                                 |  |
+----------------------------------------------------------+  |
| TLS Client Hello (incl. TLS SNI)                         |  |
+----------------------------------------------------------+  |
| QUIC PADDING frame                                       |  |
+----------------------------------------------------------+&lt;-+
</pre>
<p class="figure">Figure 2: Typical 1-RTT QUIC Client Hello datagram pattern</p>
<p id="rfc.section.2.4.p.9">The Client Hello datagram exposes version number, source and destination connection IDs, and information in the TLS Client Hello message, including any TLS Server Name Indication (SNI) present, in the clear. The QUIC PADDING frame shown here may be present to ensure the Client Hello datagram has a minimum size of 1200 octets, to mitigate the possibility of handshake amplification. Note that the location of PADDING is implementation-dependent, and PADDING frames may not appear in the Initial packet in a coalesced packet.</p>
<div id="rfc.figure.3"></div>
<div id="fig-server-hello"></div>
<pre>
+------------------------------------------------------------+
| UDP header (source and destination UDP ports)              |
+------------------------------------------------------------+
| QUIC long header (type = Initial, Version, DCID, SCID)   (Length)
+------------------------------------------------------------+  |
| QUIC CRYPTO frame header                                   |  |
+------------------------------------------------------------+  |
| TLS Server Hello                                           |  |
+------------------------------------------------------------+  |
| QUIC ACK frame (acknowledging client hello)                |  |
+------------------------------------------------------------+&lt;-+
| QUIC long header (type = Handshake, Version, DCID, SCID) (Length)
+------------------------------------------------------------+  |
| encrypted payload (presumably CRYPTO frames)               |  |
+------------------------------------------------------------+&lt;-+
| QUIC short header                                          |
+------------------------------------------------------------+
| 1-RTT encrypted payload                                    |
+------------------------------------------------------------+
</pre>
<p class="figure">Figure 3: Typical QUIC Server Hello datagram pattern</p>
<p id="rfc.section.2.4.p.10">The Server Hello datagram exposes version number, source and destination connection IDs, and information in the TLS Server Hello message.</p>
<div id="rfc.figure.4"></div>
<div id="fig-init-complete"></div>
<pre>
+------------------------------------------------------------+
| UDP header (source and destination UDP ports)              |
+------------------------------------------------------------+
| QUIC long header (type = Initial, Version, DCID, SCID)   (Length)
+------------------------------------------------------------+  |
| QUIC ACK frame (acknowledging Server Hello Initial)        |  |
+------------------------------------------------------------+&lt;-+
| QUIC long header (type = Handshake, Version, DCID, SCID) (Length)
+------------------------------------------------------------+  |
| encrypted payload (presumably CRYPTO/ACK frames)           |  |
+------------------------------------------------------------+&lt;-+
| QUIC short header                                          |
+------------------------------------------------------------+
| 1-RTT encrypted payload                                    |
+------------------------------------------------------------+
</pre>
<p class="figure">Figure 4: Typical QUIC Initial Completion datagram pattern</p>
<p id="rfc.section.2.4.p.11">The Initial Completion datagram does not expose any additional information; however, recognizing it can be used to determine that a handshake has completed (see <a href="#sec-confirm" class="xref">Section 3.2</a>), and for three-way handshake RTT estimation as in <a href="#sec-rtt" class="xref">Section 3.7</a>.</p>
<div id="rfc.figure.5"></div>
<div id="fig-hs-complete"></div>
<pre>
+------------------------------------------------------------+
| UDP header (source and destination UDP ports)              |
+------------------------------------------------------------+
| QUIC long header (type = Handshake, Version, DCID, SCID) (Length)
+------------------------------------------------------------+  |
| encrypted payload (presumably ACK frame)                   |  |
+------------------------------------------------------------+&lt;-+
| QUIC short header                                          |
+------------------------------------------------------------+
| 1-RTT encrypted payload                                    |
+------------------------------------------------------------+
</pre>
<p class="figure">Figure 5: Typical QUIC Handshake Completion datagram pattern</p>
<p id="rfc.section.2.4.p.12">Similar to Initial Completion, Handshake Completion also exposes no additional information; observing it serves only to determine that the handshake has completed.</p>
<p id="rfc.section.2.4.p.13">When the client uses 0-RTT connection resumption, 0-RTT data may also be seen in the QUIC Client Hello datagram, as shown in <a href="#fig-client-hello-0rtt" class="xref">Figure 6</a>.</p>
<div id="rfc.figure.6"></div>
<div id="fig-client-hello-0rtt"></div>
<pre>
+----------------------------------------------------------+
| UDP header (source and destination UDP ports)            |
+----------------------------------------------------------+
| QUIC long header (type = Initial, Version, DCID, SCID) (Length)
+----------------------------------------------------------+  |
| QUIC CRYPTO frame header                                 |  |
+----------------------------------------------------------+  |
| TLS Client Hello (incl. TLS SNI)                         |  |
+----------------------------------------------------------+&lt;-+
| QUIC long header (type = 0RTT, Version, DCID, SCID)    (Length)
+----------------------------------------------------------+  |
| 0-rtt encrypted payload                                  |  |
+----------------------------------------------------------+&lt;-+
</pre>
<p class="figure">Figure 6: Typical 0-RTT QUIC Client Hello datagram pattern</p>
<p id="rfc.section.2.4.p.14">In a 0-RTT QUIC Client Hello datagram, the PADDING frame is only present if necessary to increase the size of the datagram with 0RTT data to at least 1200 bytes. Additional datagrams containing only 0-RTT protected long header packets may be sent from the client to the server after the Client Hello datagram, containing the rest of the 0-RTT data. The amount of 0-RTT protected data is limited by the initial congestion window, typically around 10 packets <a href="#RFC6928" class="xref">[RFC6928]</a>.</p>
<h1 id="rfc.section.2.5">
<a href="#rfc.section.2.5">2.5.</a> <a href="#wire-integrity" id="wire-integrity">Integrity Protection of the Wire Image</a>
</h1>
<p id="rfc.section.2.5.p.1">As soon as the cryptographic context is established, all information in the QUIC header, including information exposed in the packet header, is integrity protected. Further, information that was sent and exposed in handshake packets sent before the cryptographic context was established are validated later during the cryptographic handshake.  Therefore, devices on path MUST NOT change any information or bits in QUIC packet headers, since alteration of header information will lead to a failed integrity check at the receiver, and can even lead to connection termination.</p>
<h1 id="rfc.section.2.6">
<a href="#rfc.section.2.6">2.6.</a> <a href="#rebinding" id="rebinding">Connection ID and Rebinding</a>
</h1>
<p id="rfc.section.2.6.p.1">The connection ID in the QUIC packet headers allows routing of QUIC packets at load balancers on other than five-tuple information, ensuring that related flows are appropriately balanced together; and to allow rebinding of a connection after one of the endpoint&#8217;s addresses changes - usually the client&#8217;s, in the case of the HTTP binding. Client and server negotiate connection IDs during the handshake; typically, however, only the server will request a connection ID for the lifetime of the connection. Connection IDs for either endpoint may change during the lifetime of a connection, with the new connection ID being negotiated via encrypted frames. See Section 5.1 of <a href="#QUIC-TRANSPORT" class="xref">[QUIC-TRANSPORT]</a>.</p>
<h1 id="rfc.section.2.7">
<a href="#rfc.section.2.7">2.7.</a> <a href="#packetnumber" id="packetnumber">Packet Numbers</a>
</h1>
<p id="rfc.section.2.7.p.1">The packet number field is always present in the QUIC packet header; however, it is always encrypted. The encryption key for packet number protection on handshake packets sent before cryptographic context establishment is specific to the QUIC version, while packet number protection on subsequent packets uses secrets derived from the end-to-end cryptographic context. Packet numbers are therefore not part of the wire image that is visible to on-path observers.</p>
<h1 id="rfc.section.2.8">
<a href="#rfc.section.2.8">2.8.</a> <a href="#version" id="version">Version Negotiation and Greasing</a>
</h1>
<p id="rfc.section.2.8.p.1">Version negotiation is not protected, given the used protection mechanism can change with the version.  However, the choices provided in the list of version in the Version Negotiation packet will be validated as soon as the cryptographic context has been established. Therefore any manipulation of this list will be detected and will cause the endpoints to terminate the connection.</p>
<p id="rfc.section.2.8.p.2">Also note that the list of versions in the Version Negotiation packet may contain reserved versions. This mechanism is used to avoid ossification in the implementation on the selection mechanism. Further, a client may send a Initial Client packet with a reserved version number to trigger version negotiation. In the Version Negotiation packet the connection ID and packet number of the Client Initial packet are reflected to provide a proof of return-routability. Therefore changing these information will also cause the connection to fail.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#network-visible-information-about-quic-flows" id="network-visible-information-about-quic-flows">Network-visible information about QUIC flows</a>
</h1>
<p id="rfc.section.3.p.1">This section addresses the different kinds of observations and inferences that can be made about QUIC flows by a passive observer in the network based on the wire image in <a href="#sec-wire-image" class="xref">Section 2</a>. Here we assume a bidirectional observer (one that can see packets in both directions in the sequence in which they are carried on the wire) unless noted.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#sec-identifying" id="sec-identifying">Identifying QUIC traffic</a>
</h1>
<p id="rfc.section.3.1.p.1">The QUIC wire image is not specifically designed to be distinguishable from other UDP traffic.</p>
<p id="rfc.section.3.1.p.2">The only application binding currently defined for QUIC is HTTP <a href="#QUIC-HTTP" class="xref">[QUIC-HTTP]</a>. HTTP over QUIC uses UDP port 443 by default, although URLs referring to resources available over HTTP over QUIC may specify alternate port numbers. Simple assumptions about whether a given flow is using QUIC based upon a UDP port number may therefore not hold; see also <a href="#RFC7605" class="xref">[RFC7605]</a> section 5.</p>
<p id="rfc.section.3.1.p.3">While the second most significant bit (0x40) of the first octet is always set to 1 in QUIC packets of the current version, this is not a recommended method of recognizing QUIC traffic, as it only provides one bit of information and is quite prone to collide with UDP-based protocols other than those that this static bit is meant to allow multiplexing with.</p>
<h1 id="rfc.section.3.1.1">
<a href="#rfc.section.3.1.1">3.1.1.</a> <a href="#identifying-negotiated-version" id="identifying-negotiated-version">Identifying Negotiated Version</a>
</h1>
<p id="rfc.section.3.1.1.p.1">An in-network observer assuming that a set of packets belongs to a QUIC flow can infer the version number in use by observing the handshake: an Initial packet with a given version from a client to which a server responds with an Initial packet with the same version implies acceptance of that version.</p>
<p id="rfc.section.3.1.1.p.2">Negotiated version cannot be identified for flows for which a handshake is not observed, such as in the case of connection migration; however, these flows can be associated with flows for which a version has been identified; see <a href="#sec-flow-association" class="xref">Section 3.4</a>.</p>
<p id="rfc.section.3.1.1.p.3">In the rest of this section, we discuss only packets belonging to Version 1 QUIC flows, and assume that these packets have been identified as such through the observation of a version negotiation.</p>
<h1 id="rfc.section.3.1.2">
<a href="#rfc.section.3.1.2">3.1.2.</a> <a href="#sec-garbage" id="sec-garbage">Rejection of Garbage Traffic</a>
</h1>
<p id="rfc.section.3.1.2.p.1">A related question is whether a first packet of a given flow on known QUIC-associated port is a valid QUIC packet, in order to support in-network filtering of garbage UDP packets (reflection attacks, random backscatter). While heuristics based on the first byte of the packet (packet type) could be used to separate valid from invalid first packet types, the deployment of such heuristics is not recommended, as packet types may have different meanings in future versions of the protocol.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#sec-confirm" id="sec-confirm">Connection confirmation</a>
</h1>
<p id="rfc.section.3.2.p.1">Connection establishment uses Initial, Handshake, and Retry packets containing a TLS handshake. Connection establishment can therefore be detected using heuristics similar to those used to detect TLS over TCP. A client using 0-RTT connection may also send data packets in 0-RTT Protected packets directly after the Initial packet containing the TLS Client Hello. Since these packets may be reordered in the network, note that 0-RTT Protected data packets may be seen before the Initial packet.</p>
<p id="rfc.section.3.2.p.2">Note that clients send Initial packets before servers do, servers send Handshake packets before  clients do, and only clients send Initial packets with tokens, so the sides of a connection can be generally be confirmed by an on-path observer. An attempted connection after Retry can be detected by correlating the token on the Retry with the token on the subsequent Initial packet.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#sec-server" id="sec-server">Application Identification</a>
</h1>
<p id="rfc.section.3.3.p.1">The cleartext TLS handshake may contain Server Name Indication (SNI) <a href="#RFC6066" class="xref">[RFC6066]</a>, by which the client reveals the name of the server it intends to connect to, in order to allow the server to present a certificate based on that name. It may also contain information from Application-Layer Protocol Negotiation (ALPN) <a href="#RFC7301" class="xref">[RFC7301]</a>, by which the client exposes the names of application-layer protocols it supports; an observer can deduce that one of those protocols will be used if the connection continues.</p>
<p id="rfc.section.3.3.p.2">Work is currently underway in the TLS working group to encrypt the SNI in TLS 1.3 <a href="#TLS-ESNI" class="xref">[TLS-ESNI]</a>. If used with QUIC, this would make SNI-based application identification impossible through passive measurement.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#sec-flow-association" id="sec-flow-association">Flow association</a>
</h1>
<p id="rfc.section.3.4.p.1">The QUIC Connection ID (see <a href="#rebinding" class="xref">Section 2.6</a>) is designed to allow an on-path device such as a load-balancer to associate two flows as identified by five-tuple when the address and port of one of the endpoints changes; e.g. due to NAT rebinding or server IP address migration. An observer keeping flow state can associate a connection ID with a given flow, and can associate a known flow with a new flow when when observing a packet sharing a connection ID and one endpoint address (IP address and port) with the known flow.</p>
<p id="rfc.section.3.4.p.2">However, since the connection ID may change multiple times during the lifetime of a flow, and the negotiation of connection ID changes is encrypted, packets with the same 5-tuple but different connection IDs may or may not belong to the same connection.</p>
<p id="rfc.section.3.4.p.3">The connection ID value should be treated as opaque; see <a href="#sec-loadbalancing" class="xref">Section 4.3</a> for caveats regarding connection ID selection at servers.</p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> <a href="#sec-teardown" id="sec-teardown">Flow teardown</a>
</h1>
<p id="rfc.section.3.5.p.1">QUIC does not expose the end of a connection; the only indication to on-path devices that a flow has ended is that packets are no longer observed. Stateful devices on path such as NATs and firewalls must therefore use idle timeouts to determine when to drop state for QUIC flows.</p>
<p id="rfc.section.3.5.p.2">Changes to this behavior have been discussed in the working group, but there is no current proposal to implement these changes:  see https://github.com/quicwg/base-drafts/issues/602.</p>
<h1 id="rfc.section.3.6">
<a href="#rfc.section.3.6">3.6.</a> <a href="#sec-symmetry" id="sec-symmetry">Flow symmetry measurement</a>
</h1>
<p id="rfc.section.3.6.p.1">QUIC explicitly exposes which side of a connection is a client and which side is a server during the handshake. In addition, the symmetry of a flow (whether primarily client-to-server, primarily server-to-client, or roughly bidirectional, as input to basic traffic classification techniques) can be inferred through the measurement of data rate in each direction. While QUIC traffic is protected and ACKs may be padded, padding is not required.</p>
<h1 id="rfc.section.3.7">
<a href="#rfc.section.3.7">3.7.</a> <a href="#sec-rtt" id="sec-rtt">Round-Trip Time (RTT) Measurement</a>
</h1>
<p id="rfc.section.3.7.p.1">Round-trip time of QUIC flows can be inferred by observation once per flow, during the handshake, as in passive TCP measurement; this requires parsing of the QUIC packet header and recognition of the handshake, as illustrated in <a href="#handshake" class="xref">Section 2.4</a>. It can also be inferred during the flow&#8217;s lifetime, if the endpoints use the spin bit facility described below and in <a href="#QUIC-TRANSPORT" class="xref">[QUIC-TRANSPORT]</a>, section 17.3.1.</p>
<h1 id="rfc.section.3.7.1">
<a href="#rfc.section.3.7.1">3.7.1.</a> <a href="#measuring-initial-rtt" id="measuring-initial-rtt">Measuring initial RTT</a>
</h1>
<p id="rfc.section.3.7.1.p.1">In the common case, the delay between the Initial packet containing the TLS Client Hello and the Handshake packet containing the TLS Server Hello represents the RTT component on the path between the observer and the server.  The delay between the TLS Server Hello and the Handshake packet containing the TLS Finished message sent by the client represents the RTT component on the path between the observer and the client. While the client may send 0-RTT Protected packets after the Initial packet during 0-RTT connection re-establishment, these can be ignored for RTT measurement purposes.</p>
<p id="rfc.section.3.7.1.p.2">Handshake RTT can be measured by adding the client-to-observer and observer-to-server RTT components together. This measurement necessarily includes any transport and application layer delay (the latter mainly caused by the asymmetric crypto operations associated with the TLS handshake) at both sides.</p>
<h1 id="rfc.section.3.7.2">
<a href="#rfc.section.3.7.2">3.7.2.</a> <a href="#spin-usage" id="spin-usage">Using the Spin Bit for Passive RTT Measurement</a>
</h1>
<p id="rfc.section.3.7.2.p.1">The spin bit provides an additional method to measure per-flow RTT from observation points on the network path throughout the duration of a connection.  Endpoint participation in spin bit signaling is optional in QUIC. That is, while its location is fixed in this version of QUIC, an endpoint can unilaterally choose to not support &#8220;spinning&#8221; the bit. Use of the spin bit for RTT measurement by devices on path is only possible when both endpoints enable it.  Some endpoints may disable use of the spin bit by default, others only in specific deployment scenarios, e.g. for servers and clients where the RTT would reveal the presence of a VPN or proxy. To avoid making these connections identifiable based on the usage of the spin bit, it is recommended that all endpoints randomly disable &#8220;spinning&#8221; for at least one eighth of connections, even if otherwise enabled by default. An endpoint not participating in spin bit signaling for a given connection can use a fixed spin value for the duration of the connection, or can set the bit randomly on each packet sent.</p>
<p id="rfc.section.3.7.2.p.2">When in use and a QUIC flow sends data continuously, the latency spin bit in each direction changes value once per round-trip time (RTT). An on-path observer can observe the time difference between edges (changes from 1 to 0 or 0 to 1) in the spin bit signal in a single direction to measure one sample of end-to-end RTT.</p>
<p id="rfc.section.3.7.2.p.3">Note that this measurement, as with passive RTT measurement for TCP, includes any transport protocol delay (e.g., delayed sending of acknowledgements) and/or application layer delay (e.g., waiting for a response to be generated). It therefore provides devices on path a good instantaneous estimate of the RTT as experienced by the application. A simple linear smoothing or moving minimum filter can be applied to the stream of RTT information to get a more stable estimate.</p>
<p id="rfc.section.3.7.2.p.4">However, application-limited and flow-control-limited senders can have application and transport layer delay, respectively, that are much greater than network RTT. When the sender is application-limited and e.g. only sends small amount of periodic application traffic, where that period is longer than the RTT, measuring the spin bit provides information about the application period, not the network RTT.</p>
<p id="rfc.section.3.7.2.p.5">Since the spin bit logic at each endpoint considers only samples from packets that advance the largest packet number, signal generation itself is resistant to reordering. However, reordering can cause problems at an observer by causing spurious edge detection and therefore inaccurate (i.e., lower) RTT estimates, if reordering occurs across a spin-bit flip in the stream.</p>
<p id="rfc.section.3.7.2.p.6">Simple heuristics based on the observed data rate per flow or changes in the RTT series can be used to reject bad RTT samples due to lost or reordered edges in the spin signal, as well as application or flow control limitation; for example, QoF <a href="#TMA-QOF" class="xref">[TMA-QOF]</a> rejects component RTTs significantly higher than RTTs over the history of the flow. These heuristics may use the handshake RTT as an initial RTT estimate for a given flow. Usually such heuristics would also detect if the spin is either constant or randomly set for a connection.</p>
<p id="rfc.section.3.7.2.p.7">An on-path observer that can see traffic in both directions (from client to server and from server to client) can also use the spin bit to measure &#8220;upstream&#8221; and &#8220;downstream&#8221; component RTT; i.e, the component of the end-to-end RTT attributable to the paths between the observer and the server and the observer and the client, respectively. It does this by measuring the delay between a spin edge observed in the upstream direction and that observed in the downstream direction, and vice versa.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#specific-network-management-tasks" id="specific-network-management-tasks">Specific Network Management Tasks</a>
</h1>
<p id="rfc.section.4.p.1">In this section, we review specific network management and measurement techniques and how QUIC&#8217;s design impacts them.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#sec-stateful" id="sec-stateful">Stateful treatment of QUIC traffic</a>
</h1>
<p id="rfc.section.4.1.p.1">Stateful treatment of QUIC traffic (e.g., at a firewall or NAT middlebox) is possible through QUIC traffic and version identification (<a href="#sec-identifying" class="xref">Section 3.1</a>) and observation of the handshake for connection confirmation (<a href="#sec-confirm" class="xref">Section 3.2</a>). The lack of any visible end-of-flow signal (<a href="#sec-teardown" class="xref">Section 3.5</a>) means that this state must be purged either through timers or through least-recently-used eviction, depending on application requirements.</p>
<p id="rfc.section.4.1.p.2">The QUIC header optionally contains a Connection ID which can be used as additional entropy beyond the 5-tuple, if needed. The QUIC handshake needs to be observed in order to understand whether the Connection ID is present and what length it has.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#passive-network-performance-measurement-and-troubleshooting" id="passive-network-performance-measurement-and-troubleshooting">Passive network performance measurement and troubleshooting</a>
</h1>
<p id="rfc.section.4.2.p.1">Limited RTT measurement is possible by passive observation of QUIC traffic; see <a href="#sec-rtt" class="xref">Section 3.7</a>. No passive measurement of loss is possible with the present wire image. Extremely limited observation of upstream congestion may be possible via the observation of CE markings on ECN-enabled QUIC traffic.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#sec-loadbalancing" id="sec-loadbalancing">Server cooperation with load balancers</a>
</h1>
<p id="rfc.section.4.3.p.1">In the case of content distribution networking architectures including load balancers, the connection ID provides a way for the server to signal information about the desired treatment of a flow to the load balancers. Guidance on assigning connection IDs is given in <a href="#QUIC-APPLICABILITY" class="xref">[QUIC-APPLICABILITY]</a>.</p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#sec-ddos-dec" id="sec-ddos-dec">DDoS Detection and Mitigation</a>
</h1>
<p id="rfc.section.4.4.p.1">Current practices in detection and mitigation of Distributed Denial of Service (DDoS) attacks generally involve passive measurement using network flow data <a href="#RFC7011" class="xref">[RFC7011]</a>, classification of traffic into &#8220;good&#8221; (productive) and &#8220;bad&#8221; (DoS) flows, and filtering of these bad flows in a &#8220;scrubbing&#8221; environment. Key to successful DDoS mitigation is efficient classification of this traffic.</p>
<p id="rfc.section.4.4.p.2">Limited first-packet garbage detection as in <a href="#sec-garbage" class="xref">Section 3.1.2</a> and stateful tracking of QUIC traffic as in <a href="#sec-stateful" class="xref">Section 4.1</a> above can be used in this classification step.</p>
<p id="rfc.section.4.4.p.3">Note that the use of a connection ID to support connection migration renders 5-tuple based filtering insufficient, and requires more state to be maintained by DDoS defense systems, and linkability resistance in connection ID update mechanisms means that a connection ID aware DDoS defense system must have the same information about flows as the load balancer.</p>
<p id="rfc.section.4.4.p.4">However, it is questionable if connection migrations needs to be supported in a DDOS attack. If the connection migration is not visible to the network that performs the DDoS detection, an active, migrated QUIC connection may be blocked by such a system under attack. However, a defense system might simply rely on the fast resumption mechanism provided by QUIC.</p>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> <a href="#distinguishing-acknowledgment-traffic" id="distinguishing-acknowledgment-traffic">Distinguishing acknowledgment traffic</a>
</h1>
<p id="rfc.section.4.5.p.1">Some deployed in-network functions distinguish pure-acknowledgment (ACK) packets from packets carrying upper-layer data in order to attempt to enhance performance, for example by queueing ACKs differently or manipulating ACK signaling. Distinguishing ACK packets is trivial in TCP, but not supported by QUIC, since acknowledgment signaling is carried inside QUIC&#8217;s encrypted payload, and ACK manipulation is impossible. Specifically, heuristics attempting to distinguish ACK-only packets from payload-carrying packets based on packet size are likely to fail, and are emphatically NOT RECOMMENDED.</p>
<h1 id="rfc.section.4.6">
<a href="#rfc.section.4.6">4.6.</a> <a href="#qos-support-and-ecmp" id="qos-support-and-ecmp">QoS support and ECMP</a>
</h1>
<p id="rfc.section.4.6.p.1">[EDITOR&#8217;S NOTE: this is a bit speculative; keep?]</p>
<p id="rfc.section.4.6.p.2">QUIC does not provide any additional information on requirements on Quality of Service (QoS) provided from the network. QUIC assumes that all packets with the same 5-tuple {dest addr, source addr, protocol, dest port, source port} will receive similar network treatment.  That means all stream that are multiplexed over the same QUIC connection require the same network treatment and are handled by the same congestion controller. If differential network treatment is desired, multiple QUIC connections to the same server might be used, given that establishing a new connection using 0-RTT support is cheap and fast.</p>
<p id="rfc.section.4.6.p.3">QoS mechanisms in the network MAY also use the connection ID for service differentiation, as a change of connection ID is bound to a change of address which anyway is likely to lead to a re-route on a different path with different network characteristics.</p>
<p id="rfc.section.4.6.p.4">Given that QUIC is more tolerant of packet re-ordering than TCP (see <a href="#packetnumber" class="xref">Section 2.7</a>), Equal-cost multi-path routing (ECMP) does not necessarily need to be flow based.  However, 5-tuple (plus eventually connection ID if present) matching is still beneficial for QoS given all packets are handled by the same congestion controller.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a>
</h1>
<p id="rfc.section.5.p.1">This document has no actions for IANA.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a>
</h1>
<p id="rfc.section.6.p.1">Supporting manageability of QUIC traffic inherently involves tradeoffs with the confidentiality of QUIC&#8217;s control information; this entire document is therefore security-relevant.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#contributors" id="contributors">Contributors</a>
</h1>
<p id="rfc.section.7.p.1">Dan Druta contributed text to <a href="#sec-ddos-dec" class="xref">Section 4.4</a>. Igor Lubashev contributed text to <a href="#sec-loadbalancing" class="xref">Section 4.3</a> on the use of the connection ID for load balancing.  Marcus Ilhar contributed text to <a href="#sec-rtt" class="xref">Section 3.7</a> on the use of the spin bit.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#acknowledgments" id="acknowledgments">Acknowledgments</a>
</h1>
<p id="rfc.section.8.p.1">This work is partially supported by the European Commission under Horizon 2020 grant agreement no. 688421 Measurement and Architecture for a Middleboxed Internet (MAMI), and by the Swiss State Secretariat for Education, Research, and Innovation under contract no. 15.0268. This support does not imply endorsement.</p>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8174">[RFC8174]</b></td>
<td class="top">
<a>Leiba, B.</a>, "<a href="https://tools.ietf.org/html/rfc8174">Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</a>", BCP 14, RFC 8174, DOI 10.17487/RFC8174, May 2017.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="Ding2015">[Ding2015]</b></td>
<td class="top">
<a>Ding, H.</a> and <a>M. Rabinovich</a>, "<a href="http://www.sigcomm.org/sites/default/files/ccr/papers/2015/July/0000000-0000002.pdf">TCP Stretch Acknowledgments and Timestamps - Findings and Impliciations for Passive RTT Measurement (ACM Computer Communication Review)</a>", July 2015.</td>
</tr>
<tr>
<td class="reference"><b id="IPIM">[IPIM]</b></td>
<td class="top">
<a>Allman, M.</a>, <a>Beverly, R.</a> and <a>B. Trammell</a>, "<a href="https://arxiv.org/abs/1612.02902">In-Protocol Internet Measurement (arXiv preprint 1612.02902)</a>", December 2016.</td>
</tr>
<tr>
<td class="reference"><b id="QUIC-APPLICABILITY">[QUIC-APPLICABILITY]</b></td>
<td class="top">
<a>Kuehlewind, M.</a> and <a>B. Trammell</a>, "<a href="https://tools.ietf.org/html/draft-ietf-quic-applicability-04">Applicability of the QUIC Transport Protocol</a>", Internet-Draft draft-ietf-quic-applicability-04, April 2019.</td>
</tr>
<tr>
<td class="reference"><b id="QUIC-HTTP">[QUIC-HTTP]</b></td>
<td class="top">
<a>Bishop, M.</a>, "<a href="https://tools.ietf.org/html/draft-ietf-quic-http-20">Hypertext Transfer Protocol Version 3 (HTTP/3)</a>", Internet-Draft draft-ietf-quic-http-20, April 2019.</td>
</tr>
<tr>
<td class="reference"><b id="QUIC-INVARIANTS">[QUIC-INVARIANTS]</b></td>
<td class="top">
<a>Thomson, M.</a>, "<a href="https://tools.ietf.org/html/draft-ietf-quic-invariants-04">Version-Independent Properties of QUIC</a>", Internet-Draft draft-ietf-quic-invariants-04, April 2019.</td>
</tr>
<tr>
<td class="reference"><b id="QUIC-TLS">[QUIC-TLS]</b></td>
<td class="top">
<a>Thomson, M.</a> and <a>S. Turner</a>, "<a href="https://tools.ietf.org/html/draft-ietf-quic-tls-20">Using TLS to Secure QUIC</a>", Internet-Draft draft-ietf-quic-tls-20, April 2019.</td>
</tr>
<tr>
<td class="reference"><b id="QUIC-TRANSPORT">[QUIC-TRANSPORT]</b></td>
<td class="top">
<a>Iyengar, J.</a> and <a>M. Thomson</a>, "<a href="https://tools.ietf.org/html/draft-ietf-quic-transport-20">QUIC: A UDP-Based Multiplexed and Secure Transport</a>", Internet-Draft draft-ietf-quic-transport-20, April 2019.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6066">[RFC6066]</b></td>
<td class="top">
<a>Eastlake 3rd, D.</a>, "<a href="https://tools.ietf.org/html/rfc6066">Transport Layer Security (TLS) Extensions: Extension Definitions</a>", RFC 6066, DOI 10.17487/RFC6066, January 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6928">[RFC6928]</b></td>
<td class="top">
<a>Chu, J.</a>, <a>Dukkipati, N.</a>, <a>Cheng, Y.</a> and <a>M. Mathis</a>, "<a href="https://tools.ietf.org/html/rfc6928">Increasing TCP's Initial Window</a>", RFC 6928, DOI 10.17487/RFC6928, April 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7011">[RFC7011]</b></td>
<td class="top">
<a>Claise, B.</a>, <a>Trammell, B.</a> and <a>P. Aitken</a>, "<a href="https://tools.ietf.org/html/rfc7011">Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of Flow Information</a>", STD 77, RFC 7011, DOI 10.17487/RFC7011, September 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7301">[RFC7301]</b></td>
<td class="top">
<a>Friedl, S.</a>, <a>Popov, A.</a>, <a>Langley, A.</a> and <a>E. Stephan</a>, "<a href="https://tools.ietf.org/html/rfc7301">Transport Layer Security (TLS) Application-Layer Protocol Negotiation Extension</a>", RFC 7301, DOI 10.17487/RFC7301, July 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7605">[RFC7605]</b></td>
<td class="top">
<a>Touch, J.</a>, "<a href="https://tools.ietf.org/html/rfc7605">Recommendations on Using Assigned Transport Port Numbers</a>", BCP 165, RFC 7605, DOI 10.17487/RFC7605, August 2015.</td>
</tr>
<tr>
<td class="reference"><b id="TLS-ESNI">[TLS-ESNI]</b></td>
<td class="top">
<a>Rescorla, E.</a>, <a>Oku, K.</a>, <a>Sullivan, N.</a> and <a>C. Wood</a>, "<a href="https://tools.ietf.org/html/draft-ietf-tls-esni-03">Encrypted Server Name Indication for TLS 1.3</a>", Internet-Draft draft-ietf-tls-esni-03, March 2019.</td>
</tr>
<tr>
<td class="reference"><b id="TMA-QOF">[TMA-QOF]</b></td>
<td class="top">
<a>Trammell, B.</a>, <a>Gugelmann, D.</a> and <a>N. Brownlee</a>, "<a>Inline Data Integrity Signals for Passive Measurement (in Proc. TMA 2014)</a>", April 2014.</td>
</tr>
<tr>
<td class="reference"><b id="WIRE-IMAGE">[WIRE-IMAGE]</b></td>
<td class="top">
<a>Trammell, B.</a> and <a>M. Kuehlewind</a>, "<a href="https://tools.ietf.org/html/rfc8546">The Wire Image of a Network Protocol</a>", RFC 8546, DOI 10.17487/RFC8546, April 2019.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Mirja Kuehlewind</span> 
	  <span class="n hidden">
		<span class="family-name">Kuehlewind</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mirja.kuehlewind@ericsson.com">mirja.kuehlewind@ericsson.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Brian Trammell</span> 
	  <span class="n hidden">
		<span class="family-name">Trammell</span>
	  </span>
	</span>
	<span class="org vcardline">Google</span>
	<span class="adr">
	  <span class="vcardline">Gustav-Gull-Platz 1</span>

	  <span class="vcardline">
		<span class="locality">8004 Zurich</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Switzerland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ietf@trammell.ch">ietf@trammell.ch</a></span>

  </address>
</div>

</body>
</html>
